# OpenAI Bot

Приложение для работы с OpenAI API: интерактивный CLI и Telegram-бот с поддержкой контекста диалога и учётом токенов.

## Возможности

- **CLI** (`main.py`) — интерактивный диалог в терминале: ввод сообщения, температуры, лимита токенов и опционального system message. Вывод ответа с информацией о токенах.
- **Telegram-бот** (`bot.py`) — диалог с GPT в Telegram с персональным контекстом для каждого пользователя, учёт токенов в SQLite, команды `/clear`, `/stats`.

## Требования

- Python 3.10+
- Аккаунт OpenAI (API-ключ)
- Для бота: токен бота от [@BotFather](https://t.me/BotFather)

## Установка

```bash
git clone https://github.com/YOUR_USERNAME/openai_bot.git
cd openai_bot
python -m venv .venv
source .venv/bin/activate   # Windows: .venv\Scripts\activate
pip install -r requirements.txt
```

## Настройка

Скопируйте пример конфигурации и заполните ключи:

```bash
cp .env.example .env
```

Отредактируйте `.env`:

| Переменная | Описание |
|------------|----------|
| `OPENAI_API_KEY` | Ключ API OpenAI (обязательно для CLI и бота) |
| `BOT_TOKEN` | Токен Telegram-бота (обязательно для бота) |
| `OPENAI_MODEL` | Модель для CLI (по умолчанию `gpt-4.1`) |
| `BOT_OPENAI_MODEL` | Модель для бота (по умолчанию `gpt-5-mini-2025-08-07`) |
| `TOKEN_USAGE_DB_PATH` | Путь к SQLite-файлу учёта токенов (по умолчанию `token_usage.db`) |

**Важно:** файл `.env` не попадает в репозиторий — не публикуйте ключи.

## Запуск

### CLI

```bash
python main.py
```

После запуска программа запросит сообщение, температуру, лимит токенов и опционально system message, затем отправит запрос и выведет ответ с данными о токенах.

### Telegram-бот

```bash
python bot.py
```

Команды бота:

- `/start` — приветствие и подсказки
- `/clear` — очистить контекст диалога (также фразы: «очистить контекст», «очистить»)
- `/stats` — статистика токенов (запросы/ответы) и ориентировочная стоимость в долларах

## Структура проекта

```
openai_bot/
├── main.py           # CLI: интерактивный запрос к OpenAI
├── bot.py            # Telegram-бот (aiogram)
├── config.py         # Загрузка настроек из .env
├── openai_client.py  # Общий клиент OpenAI (get_chat_response)
├── context_manager.py # Контекст диалога (память) + учёт токенов в SQLite
├── requirements.txt
├── .env.example      # Пример переменных окружения
└── README.md
```

- Контекст диалога бота хранится в оперативной памяти (словарь по `user_id`).
- Учёт токенов по каждому запросу/ответу — в SQLite (файл по умолчанию `token_usage.db`).

## Стоимость (команда /stats)

В расчёте стоимости используются ориентировочные тарифы:

- Токены запросов: **$0.25** за 1 млн токенов  
- Токены ответов: **$2** за 1 млн токенов  

Актуальные цены смотрите на [openai.com/pricing](https://openai.com/pricing).

## Лицензия

MIT (или укажите свою).
